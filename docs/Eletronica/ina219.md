# Funcionamento do Sensor INA219

O **INA219** é um sensor utilizado para medições de **tensão**, **corrente** e **potência elétrica** em circuitos de corrente contínua (DC).  
Este documento descreve seu princípio de funcionamento, conexões elétricas, configuração via software e exemplo de utilização.

---

## 1. Conceito de Funcionamento

### 1.1 Medição de Tensão

O INA219 mede a **tensão do barramento** (*bus voltage*), ou seja, a tensão principal do circuito em relação ao **GND**.  
O dispositivo suporta medições de até **26 V**, embora as calibrações padrão da biblioteca Adafruit sejam configuradas para faixas de **16 V** e **32 V**.

---

### 1.2 Medição de Corrente

O sensor não mede a corrente diretamente; ele se baseia na **Lei de Ohm**:

$$ V = I \times R $$

Para determinar a corrente, o módulo utiliza um **resistor shunt** de precisão — geralmente identificado na placa como **R100**, com valor típico de **0,1 Ω**.  
Quando a corrente da carga passa por esse resistor, ocorre uma pequena **queda de tensão**, normalmente na faixa de milivolts.

O INA219 contém um **amplificador diferencial de alta precisão**, responsável por medir essa queda de tensão.  
Conhecendo a resistência ($R = 0.1\ \Omega$) e a diferença de potencial ($V$), o sensor calcula a corrente elétrica conforme:

$$ I = \frac{V}{R} $$

A biblioteca **Adafruit_INA219** executa automaticamente esse cálculo.  
Ao chamar `ina219.getCurrent_mA()`, a biblioteca realiza a leitura da queda de tensão e retorna o valor da corrente em **miliampères (mA)**.

---

## 2. Conexões e Configuração

O uso do INA219 requer tanto **conexões elétricas corretas (hardware)** quanto **configuração via software**.

---

### 2.1 Conexões de Hardware

#### Comunicação I²C

| Pino INA219 | Microcontrolador |
|:-------------|:-----------------|
| VCC          | 3.3 V ou 5 V |
| GND          | GND |
| SCL          | Pino SCL (ex.: D1 no NodeMCU, 22 no ESP32, A5 no Arduino Uno) |
| SDA          | Pino SDA (ex.: D2 no NodeMCU, 21 no ESP32, A4 no Arduino Uno) |

#### Conexão de Medição

O INA219 deve ser conectado **em série** com a carga a ser monitorada:

- **V-IN+** → Conectar ao polo positivo da **fonte de alimentação** (por exemplo, bateria ou fonte de 5 V).  
- **V-IN-** → Conectar ao polo positivo da **carga** (por exemplo, o VCC de um LED ou o pino V-IN de outro dispositivo).

> **Importante:**  
> Todos os **GNDs** (da fonte, da carga e do microcontrolador) devem estar interligados, garantindo um **referencial comum**.

---

### 2.2 Configuração de Software

No arquivo `platformio.ini`, incluir a dependência da biblioteca:

```ini
lib_deps = adafruit/Adafruit INA219@^1.2.3
```

No arquivo principal `src/main.cpp`, seguir as etapas:

1. **Inclusão das bibliotecas:**
   ```cpp
   #include <Wire.h>
   #include <Adafruit_INA219.h>
   ```

2. **Instanciação do objeto do sensor:**
   ```cpp
   Adafruit_INA219 ina219;
   ```

3. **Inicialização no `setup()`:**
   ```cpp
   Serial.begin(115200);     // Inicializa comunicação serial
   Wire.begin();             // Inicializa comunicação I2C
   ina219.begin();           // Inicializa o sensor INA219
   ina219.setCalibration_...(); // Define a calibração apropriada
   ```

---

### 2.3 Calibração

A calibração define o **intervalo máximo de medição** de tensão e corrente, ajustando a precisão conforme o tipo de carga monitorada.

A versão **1.2.3** da biblioteca Adafruit fornece as seguintes opções:

```cpp
ina219.setCalibration_32V_2A();     // Mede até 32 V e 2 A (padrão)
ina219.setCalibration_32V_1A();     // Mede até 32 V e 1 A
ina219.setCalibration_16V_400mA();  // Mede até 16 V e 400 mA (maior precisão em correntes baixas)
```

---

## 3. Leitura de Valores

As funções principais de leitura do INA219 são:

- **Tensão (V):**
  ```cpp
  float tensao = ina219.getBusVoltage_V();
  ```

- **Corrente (mA):**
  ```cpp
  float corrente = ina219.getCurrent_mA();
  ```

- **Potência (mW):**
  ```cpp
  float potencia = ina219.getPower_mW();
  ```

Cada função retorna um valor `float` correspondente à grandeza física medida.

---

## 4. Exemplo de Implementação

O exemplo a seguir ilustra o uso completo do sensor, incluindo inicialização, calibração e leitura periódica dos valores medidos.

```cpp
#include <Arduino.h>
#include <Wire.h>
#include <Adafruit_INA219.h>

Adafruit_INA219 ina219;

void setup() {
  Serial.begin(115200);
  while (!Serial) { delay(1); } // Aguarda a conexão serial

  Serial.println("Inicializando o sensor INA219...");

  Wire.begin();

  if (!ina219.begin()) {
    Serial.println("Erro: INA219 não detectado. Verifique as conexões.");
    while (1) { delay(10); }
  }

  // Seleciona a calibração conforme o tipo de carga
  ina219.setCalibration_32V_2A();

  Serial.println("INA219 pronto para medições.");
}

void loop() {
  float tensao_V = ina219.getBusVoltage_V();
  float corrente_mA = ina219.getCurrent_mA();
  float potencia_mW = ina219.getPower_mW();

  Serial.print("Tensão do Barramento: ");
  Serial.print(tensao_V);
  Serial.println(" V");

  Serial.print("Corrente da Carga: ");
  Serial.print(corrente_mA);
  Serial.println(" mA");

  Serial.print("Potência da Carga: ");
  Serial.print(potencia_mW);
  Serial.println(" mW");

  Serial.println("---------------------------------");

  delay(2000);
}
```

---

## 5. Considerações Finais

- O INA219 é adequado para aplicações de **monitoramento de energia** e **telemetria elétrica** em sistemas embarcados.  
- As medições dependem da precisão do resistor shunt e da calibração selecionada.  
- Recomenda-se o uso de fios curtos e conexões firmes para minimizar ruído e variações de leitura.

---
